<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifying...</title>
    <link rel="stylesheet" href="u.css">
    <link rel="icon" type="image/x-icon" id="pageFavicon" href="">
</head>
<body class="custom-body">
    <div class="custom-logo">
      <!--  <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTYgMEMyNC44MzcgMCAzMiA3LjE2MyAzMiAxNkMzMiAyNC44MzcgMjQuODM3IDMyIDE2IDMyQzcuMTYzIDMyIDAgMjQuODM3IDAgMTZDMCA3LjE2MyA3LjE2MyAwIDE2IDBaIiBmaWxsPSIjRjM4MDIwIi8+PC9zdmc+" alt="Logo" width="32" height="32"> -->
    </div>
    <div class="custom-container">
        <div class="custom-verification-box">
            <div class="custom-domain">
                <img id="urlFavicon" width="16" height="16" style="margin-right: 8px;">
                <span id="domainText"></span>
            </div>
            <div class="custom-status">
                <span class="custom-spinner" id="loadingSpinner"></span>
                Checking if the site connection is secure
            </div>
            <div class="custom-captcha-box" id="captchaBox" style="display: none;">
                <div class="custom-captcha-main">
                    <div class="custom-checkbox-container">
                        <input type="checkbox" id="verifyCheckbox">
                        <span class="custom-checkbox-text">I'm not a robot</span>
                    </div>
                </div>
                <div class="custom-captcha-logo">
                    <svg class="custom-recaptcha-logo" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="16" cy="16" r="16" fill="#4285f4"/>
                        <path d="M16 8c-4.4 0-8 3.6-8 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm-1 13l-3-3 1.4-1.4L15 18.2l4.6-4.6L21 15l-6 6z" fill="white"/>
                    </svg>
                    <div class="custom-captcha-brand">
                        <span>reCAPTCHA</span>
                        <div class="custom-privacy-terms">
                            <a href="#" onclick="return false;">Privacy</a> - <a href="#" onclick="return false;">Terms</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="custom-description">
                <span id="domainText2"></span> need to review the security of your connection before proceeding.
            </div>
        </div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const targetUrl = urlParams.get('url');
        const pageTitle = urlParams.get('title');

        // Set page title
        document.title = pageTitle || 'Verifying...';

        // Extract and display domain
        if (targetUrl) {
            try {
                const url = new URL(targetUrl);
                const domain = url.hostname;
                document.getElementById('domainText').textContent = domain;
                document.getElementById('domainText2').textContent = domain;
                
                // Set favicon for the inline image
                const faviconImg = document.getElementById('urlFavicon');
                const directFavicon = `${url.protocol}//${url.hostname}/favicon.ico`;
                const googleFavicon = `https://www.google.com/s2/favicons?domain=${domain}&sz=16`;
                
                // Try to load the direct favicon first
                faviconImg.src = directFavicon;
                
                // If the direct favicon fails, fallback to Google's service
                faviconImg.onerror = () => {
                    faviconImg.src = googleFavicon;
                };

                // Set page favicon in browser tab
                const pageFavicon = document.getElementById('pageFavicon');
                
                // Function to update page favicon
                function updatePageFavicon(faviconUrl) {
                    // Remove existing favicon links
                    const existingFavicons = document.querySelectorAll('link[rel*="icon"]');
                    existingFavicons.forEach(link => {
                        if (link.id !== 'pageFavicon') {
                            link.remove();
                        }
                    });
                    
                    // Update the main favicon
                    pageFavicon.href = faviconUrl;
                    
                    // Create additional favicon formats for better browser compatibility
                    const favicon32 = document.createElement('link');
                    favicon32.rel = 'icon';
                    favicon32.type = 'image/png';
                    favicon32.sizes = '32x32';
                    favicon32.href = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                    document.head.appendChild(favicon32);
                    
                    const favicon16 = document.createElement('link');
                    favicon16.rel = 'icon';
                    favicon16.type = 'image/png';
                    favicon16.sizes = '16x16';
                    favicon16.href = `https://www.google.com/s2/favicons?domain=${domain}&sz=16`;
                    document.head.appendChild(favicon16);
                }
                
                // Try direct favicon first
                const testImg = new Image();
                testImg.onload = () => {
                    updatePageFavicon(directFavicon);
                };
                testImg.onerror = () => {
                    // Fallback to Google's favicon service
                    updatePageFavicon(googleFavicon);
                };
                testImg.src = directFavicon;
                
            } catch (e) {
                console.error('Invalid URL');
            }
        }

        // Show captcha after 10 seconds
        setTimeout(() => {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('captchaBox').style.display = 'flex';
        }, 10000);

        // Handle checkbox click - ONLY the checkbox input can trigger this
        document.getElementById('verifyCheckbox').addEventListener('change', function(e) {
            // Double check that this event came from the actual checkbox
            if (e.target.type === 'checkbox' && e.target.id === 'verifyCheckbox') {
                if (this.checked) {
                    // Open popunder
                    const popunder = window.open('https://your-affiliate-link.com', '_blank', 'width=1,height=1');
                    if (popunder) {
                        popunder.blur();
                        window.focus();
                    }
                    
                    // Redirect to target URL
                    window.location.href = targetUrl;
                }
            }
        });

        // Prevent any bypass attempts - block all clicks except on the checkbox
        document.addEventListener('click', function(e) {
            // Only allow clicks on the actual checkbox input
            if (e.target.type !== 'checkbox' || e.target.id !== 'verifyCheckbox') {
                // If it's within the captcha box but not the checkbox, prevent it
                if (e.target.closest('.custom-captcha-box')) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    return false;
                }
            }
        }, true); // Use capture phase to catch events early

        // Additional security: prevent keyboard bypass
        document.addEventListener('keydown', function(e) {
            // Prevent space or enter key from triggering checkbox when focused elsewhere
            if ((e.key === ' ' || e.key === 'Enter') && e.target.id !== 'verifyCheckbox') {
                if (e.target.closest('.custom-captcha-box')) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            }
        });

        // Prevent programmatic checking of the checkbox
        const originalCheckboxSetter = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'checked').set;
        const originalCheckboxGetter = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'checked').get;
        Object.defineProperty(HTMLInputElement.prototype, 'checked', {
            set: function(value) {
                if (this.id === 'verifyCheckbox') {
                    // Only allow setting if it's from a user interaction
                    const stack = new Error().stack;
                    if (!stack.includes('HTMLInputElement.') && !stack.includes('change')) {
                        console.warn('Programmatic checkbox manipulation blocked');
                        return;
                    }
                }
                originalCheckboxSetter.call(this, value);
            },
            get: function() {
                return originalCheckboxGetter.call(this);
            }
        });
    </script>
</body>
</html>